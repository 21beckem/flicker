<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <title>Punch Trainer</title>
</head>
<body>
    <script>

const backgroundSamplesStr = 'data_samples/background/background-sample-1724864026050.json data_samples/background/background-sample-1724864027108.json data_samples/background/background-sample-1724864028205.json data_samples/background/background-sample-1724864028206.json data_samples/background/background-sample-1724864028207.json data_samples/background/background-sample-1724864028208.json data_samples/background/background-sample-1724864028209.json data_samples/background/background-sample-1724864028210.json data_samples/background/background-sample-1724864028211.json data_samples/background/background-sample-1724864028212.json data_samples/background/background-sample-1724864028213.json data_samples/background/background-sample-1724864028214.json data_samples/background/background-sample-1724864030336.json data_samples/background/background-sample-1724864031340.json data_samples/background/background-sample-1724864032239.json data_samples/background/background-sample-1724864033237.json data_samples/background/background-sample-1724864034186.json data_samples/background/background-sample-1724864035199.json data_samples/background/background-sample-1724864036158.json data_samples/background/background-sample-1724864037116.json data_samples/background/background-sample-1724864038096.json data_samples/background/background-sample-1724864039090.json data_samples/background/background-sample-1724864040242.json data_samples/background/background-sample-1724864043703.json data_samples/background/background-sample-1724864043747.json data_samples/background/background-sample-1724864044680.json data_samples/background/background-sample-1724864044718.json data_samples/background/background-sample-1724864045664.json data_samples/background/background-sample-1724864046616.json data_samples/background/background-sample-1724864047604.json data_samples/background/background-sample-1724864048587.json data_samples/background/background-sample-1724864049593.json data_samples/background/background-sample-1724864050493.json data_samples/background/background-sample-1724864054353.json data_samples/background/background-sample-1724864055336.json data_samples/background/background-sample-1724864056397.json data_samples/background/background-sample-1724864057317.json data_samples/background/background-sample-1724864058328.json data_samples/background/background-sample-1724864062132.json data_samples/background/background-sample-1724864063208.json data_samples/background/background-sample-1724864064153.json data_samples/background/background-sample-1724864065194.json data_samples/background/background-sample-1724864066135.json data_samples/background/background-sample-1724864067073.json data_samples/background/background-sample-1724864068081.json data_samples/background/background-sample-1724864071566.json data_samples/background/background-sample-1724864072611.json data_samples/background/background-sample-1724864073509.json data_samples/background/background-sample-1724864074463.json data_samples/background/background-sample-1724864075442.json data_samples/background/background-sample-1724864079395.json data_samples/background/background-sample-1724864080248.json data_samples/background/background-sample-1724864081302.json data_samples/background/background-sample-1724864082210.json data_samples/background/background-sample-1724864083195.json data_samples/background/background-sample-1724864086250.json data_samples/background/background-sample-1724864087207.json data_samples/background/background-sample-1724864088200.json data_samples/background/background-sample-1724864089163.json data_samples/background/background-sample-1724864090270.json data_samples/background/background-sample-1724864091162.json data_samples/background/background-sample-1724864094163.json data_samples/background/background-sample-1724864095118.json data_samples/background/background-sample-1724864096197.json data_samples/background/background-sample-1724864097155.json data_samples/background/background-sample-1724864098070.json data_samples/background/background-sample-1724864099048.json data_samples/background/background-sample-1724864100025.json data_samples/background/background-sample-1724864101016.json data_samples/background/background-sample-1724864104564.json data_samples/background/background-sample-1724864105742.json data_samples/background/background-sample-1724864106552.json data_samples/background/background-sample-1724864107546.json data_samples/background/background-sample-1724864108595.json data_samples/background/background-sample-1724864110057.json data_samples/background/background-sample-1724864112992.json data_samples/background/background-sample-1724864113982.json data_samples/background/background-sample-1724864114891.json data_samples/background/background-sample-1724864116005.json data_samples/background/background-sample-1724864116975.json data_samples/background/background-sample-1724864120210.json data_samples/background/background-sample-1724864121358.json data_samples/background/background-sample-1724864122252.json data_samples/background/background-sample-1724864123207.json data_samples/background/background-sample-1724864124164.json data_samples/background/background-sample-1724864125177.json data_samples/background/background-sample-1724864128713.json data_samples/background/background-sample-1724864129757.json data_samples/background/background-sample-1724864130713.json data_samples/background/background-sample-1724864131705.json data_samples/background/background-sample-1724864132710.json data_samples/background/background-sample-1724864135722.json data_samples/background/background-sample-1724864136767.json data_samples/background/background-sample-1724864139479.json data_samples/background/background-sample-1724864139488.json data_samples/background/background-sample-1724864140076.json data_samples/background/background-sample-1724864141024.json data_samples/background/background-sample-1724864142474.json data_samples/background/background-sample-1724864143223.json data_samples/background/background-sample-1724864144425.json data_samples/background/background-sample-1724864145409.json data_samples/background/background-sample-1724864146922.json data_samples/background/background-sample-1724864147662.json data_samples/background/background-sample-1724864148666.json data_samples/background/background-sample-1724864149685.json data_samples/background/background-sample-1724864150690.json data_samples/background/background-sample-1724864153741.json data_samples/background/background-sample-1724864154724.json data_samples/background/background-sample-1724864155691.json data_samples/background/background-sample-1724864156696.json data_samples/background/background-sample-1724864160501.json data_samples/background/background-sample-1724864161580.json data_samples/background/background-sample-1724864162538.json data_samples/background/background-sample-1724864164930.json data_samples/background/background-sample-1724864165636.json data_samples/background/background-sample-1724864166612.json data_samples/background/background-sample-1724864167605.json data_samples/background/background-sample-1724864168567.json data_samples/background/background-sample-1724864169616.json data_samples/background/background-sample-1724864172704.json data_samples/background/background-sample-1724864173668.json data_samples/background/background-sample-1724864174631.json data_samples/background/background-sample-1724864175603.json data_samples/background/background-sample-1724864176601.json data_samples/background/background-sample-1724864180245.json data_samples/background/background-sample-1724864181258.json data_samples/background/background-sample-1724864182198.json data_samples/background/background-sample-1724864183264.json data_samples/background/background-sample-1724864184879.json data_samples/background/background-sample-1724864187688.json data_samples/background/background-sample-1724864188667.json data_samples/background/background-sample-1724864189700.json data_samples/background/background-sample-1724864190620.json data_samples/background/background-sample-1724864191714.json data_samples/background/background-sample-1724864194632.json data_samples/background/background-sample-1724864195595.json data_samples/background/background-sample-1724864196564.json data_samples/background/background-sample-1724864197500.json data_samples/background/background-sample-1724864198491.json data_samples/background/background-sample-1724864199466.json data_samples/background/background-sample-1724864200526.json data_samples/background/background-sample-1724864203611.json data_samples/background/background-sample-1724864204593.json data_samples/background/background-sample-1724864205620.json data_samples/background/background-sample-1724864206524.json data_samples/background/background-sample-1724864207464.json data_samples/background/background-sample-1724864208452.json data_samples/background/background-sample-1724864209504.json data_samples/background/background-sample-1724864210355.json data_samples/background/background-sample-1724864211376.json data_samples/background/background-sample-1724864212398.json data_samples/background/background-sample-1724864213317.json data_samples/background/background-sample-1724864214375.json data_samples/background/background-sample-1724864215273.json data_samples/background/background-sample-1724864216217.json data_samples/background/background-sample-1724864217186.json data_samples/background/background-sample-1724864218780.json data_samples/background/background-sample-1724864219416.json data_samples/background/background-sample-1724864220460.json data_samples/background/background-sample-1724864221520.json data_samples/background/background-sample-1724864223262.json data_samples/background/background-sample-1724864224015.json data_samples/background/background-sample-1724864225118.json data_samples/background/background-sample-1724864225303.json data_samples/background/background-sample-1724864225845.json data_samples/background/background-sample-1724864226970.json data_samples/background/background-sample-1724864227832.json data_samples/background/background-sample-1724864228867.json data_samples/background/background-sample-1724864229770.json data_samples/background/background-sample-1724864230714.json data_samples/background/background-sample-1724864231769.json data_samples/background/background-sample-1724864232642.json data_samples/background/background-sample-1724864236279.json data_samples/background/background-sample-1724864237317.json data_samples/background/background-sample-1724864238246.json data_samples/background/background-sample-1724864239211.json data_samples/background/background-sample-1724864240259.json data_samples/background/background-sample-1724864241141.json data_samples/background/background-sample-1724864242082.json data_samples/background/background-sample-1724864243139.json data_samples/background/background-sample-1724864244076.json data_samples/background/background-sample-1724864245008.json data_samples/background/background-sample-1724864246203.json data_samples/background/background-sample-1724864246937.json data_samples/background/background-sample-1724864247899.json data_samples/background/background-sample-1724864248983.json data_samples/background/background-sample-1724864249860.json data_samples/background/background-sample-1724864252848.json data_samples/background/background-sample-1724864253889.json data_samples/background/background-sample-1724864254793.json';
let backgroundSamples = backgroundSamplesStr.split(" ");

const punchSamplesStr = 'data_samples/punches-filtered/punch-sample-1724864042734-trimmed.json data_samples/punches-filtered/punch-sample-1724864053704-trimmed.json data_samples/punches-filtered/punch-sample-1724864061653-trimmed.json data_samples/punches-filtered/punch-sample-1724864070640-trimmed.json data_samples/punches-filtered/punch-sample-1724864078332-trimmed.json data_samples/punches-filtered/punch-sample-1724864085625-trimmed.json data_samples/punches-filtered/punch-sample-1724864093595-trimmed.json data_samples/punches-filtered/punch-sample-1724864103613-trimmed.json data_samples/punches-filtered/punch-sample-1724864112592-trimmed.json data_samples/punches-filtered/punch-sample-1724864127996-trimmed.json data_samples/punches-filtered/punch-sample-1724864134969-trimmed.json data_samples/punches-filtered/punch-sample-1724864152962-trimmed.json data_samples/punches-filtered/punch-sample-1724864159918-trimmed.json data_samples/punches-filtered/punch-sample-1724864164924-trimmed.json data_samples/punches-filtered/punch-sample-1724864172396-trimmed.json data_samples/punches-filtered/punch-sample-1724864179886-trimmed.json data_samples/punches-filtered/punch-sample-1724864186849-trimmed.json data_samples/punches-filtered/punch-sample-1724864193876-trimmed.json data_samples/punches-filtered/punch-sample-1724864202817-trimmed.json data_samples/punches-filtered/punch-sample-1724864235896-trimmed.json data_samples/punches-filtered/punch-sample-1724864251924-trimmed.json';
let punchSamples = punchSamplesStr.split(" ");

async function getJSON(url) {
    const response = await fetch(url);
    return await response.json();
}
function isBad(varr) {
    return varr === undefined || varr === null;
}
function jsonDataToLargeArray(json) {
    const arr = [];
    for (const el of json) {
        if (isBad(el.gyro.x) || isBad(el.gyro.y) || isBad(el.gyro.z) || isBad(el.acel.x) || isBad(el.acel.y) || isBad(el.acel.z)) {
            console.log('found empty data');
            return false;
        }
        arr.push(el.gyro.x, el.gyro.y, el.gyro.z, el.acel.x, el.acel.y, el.acel.z);
    }
    return arr;
}

let classifier;

async function trainModel() {
    ml5.setBackend("webgl");
    classifier = ml5.neuralNetwork({
        task: "classification",
        debug: true,
    });

    console.log("Loading samples...");
    
    for (const sample of backgroundSamples) {
        console.log('.');
        let data = await getJSON('/' + sample);
        data = jsonDataToLargeArray(data);
        if (data) {
            classifier.addData(data, ['background']);
        }
    }
    for (const sample of punchSamples) {
        console.log('.');
        let data = await getJSON('/' + sample);
        data = jsonDataToLargeArray(data);
        if (data) {
            classifier.addData(data, ['punch']);
        }
    }
    classifier.normalizeData();

    console.log('Training...');

    classifier.train({
        epochs: 50,
        batchSize: 50,
    }, () => {
        console.log('Training complete');
    });
}
setTimeout(trainModel, 1000);


    </script>
</body>
</html>